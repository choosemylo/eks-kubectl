#!/usr/bin/env node

const http = require('http')
const { createTerminus } = require('@godaddy/terminus')
const mylog = require('@mylo/mylog')
const { server } = require('@mylo/service-common')
const app = require('../app/app')
const { knex } = require('../app/common/database')

server.start({
  app,
  http,
  log: mylog,
  onShutdown: () => {
    return Promise.all([
      knex.destroy().then(() => mylog.info('Cleaned up database connections'))
    ])
  },
  terminus: createTerminus
})
